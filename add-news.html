<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add News Card | AMTICS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css" integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&Lato:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
       :root {
            --form-primary-color: #3b3285;
            --form-primary-light: rgba(59, 50, 133, 0.1);
            --form-primary-dark: #2a2470;
            --form-gradient: linear-gradient(135deg, #3b3285, #4e44a3);
            --form-shadow: 0 4px 20px rgba(59, 50, 133, 0.15);
            --login-primary-color: #6b48ff;
            --login-primary-light: rgba(107, 72, 255, 0.1);
            --login-primary-dark: #4831d4;
            --login-gradient: linear-gradient(135deg, #6b48ff, #8a63ff);
            --login-shadow: 0 4px 20px rgba(107, 72, 255, 0.15);
            --text-dark: #1a1a2e;
            --text-light: #ffffff;
            --background-light: #f9f7ff;
        }

        body {
            background: var(--background-light);
            font-family: "Lato", sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
        }

        .login-container {
            background: #fff;
            border-radius: 20px;
            box-shadow: var(--login-shadow);
            padding: 2.5rem;
            width: 100%;
            max-width: 350px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(107, 72, 255, 0.2);
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--login-gradient);
            border-radius: 22px;
            z-index: -1;
            opacity: 0.15;
        }

        .login-header {
            color: var(--login-primary-color);
            font-weight: 700;
            font-size: 1.6rem;
            text-align: center;
            margin-bottom: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-label {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
            display: block;
            margin-top: 0.5rem;
        }

        .login-container .form-control {
            border-radius: 12px;
            padding: 0.75rem 1.25rem;
            border: 2px solid rgba(107, 72, 255, 0.3);
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 0.5rem;
            height: 6vh;
            font-family: "Lato", sans-serif;
        }

        .login-container .form-control:focus {
            border-color: var(--login-primary-color);
            box-shadow: 0 0 0 3px var(--login-primary-light);
            outline: none;
        }

        .btn-login {
            background: var(--login-gradient);
            color: var(--text-light);
            border: none;
            border-radius: 30px;
            padding: 0.5rem;
            font-weight: 600;
            font-size: 1rem;
            width: 100%;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--login-shadow);
            margin-top: 0.5rem;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn-login:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(107, 72, 255, 0.4);
        }

        .btn-login::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #8a63ff, #6b48ff);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .btn-login:hover::before {
            opacity: 1;
        }

        .error-message {
            color: red;
            font-size: 0.85rem;
            margin-bottom: 0.9rem;
        }

        .form-container {
            max-width: 500px;
            margin: 15px auto;
            padding: 15px;
            border: 1px solid var(--form-primary-light);
            border-radius: 8px;
            background-color: #f8f9fa;
            display: none;
        }

        .form-container.show {
            display: block;
        }

        .form-container h2 {
            font-size: 1.6em;
            margin-bottom: 15px;
            text-align: center;
            color: var(--form-primary-color);
            font-weight: 600;
            font-family: 'Montserrat', sans-serif;
        }

        .form-container label {
            display: block;
            margin: 8px 0 4px;
            font-weight: 500;
            color: var(--text-dark);
            font-size: 0.9em;
            font-family: 'Montserrat', sans-serif;
        }

        .form-container input,
        .form-container textarea,
        .form-container select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid var(--form-primary-color);
            border-radius: 4px;
            font-size: 0.9em;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }

        .form-container input:focus,
        .form-container textarea:focus,
        .form-container select:focus {
            border-color: var(--form-primary-dark);
            box-shadow: 0 0 0 3px var(--form-primary-light);
            outline: none;
        }

        .form-container textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-container button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: var(--form-primary-color);
            color: var(--text-light);
            border: none;
            border-radius: 4px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s;
            font-family: 'Montserrat', sans-serif;
        }

        .form-container button:hover {
            background-color: var(--form-primary-dark);
        }

        .form-container .logout-btn {
            background-color: #dc3545;
        }

        .form-container .logout-btn:hover {
            background-color: #c82333;
        }

        .modal-content {
            border-radius: 8px;
        }

        .modal-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid var(--form-primary-light);
        }

        .modal-body {
            padding: 0;
        }

        #loginModal .modal-dialog {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0 auto;
            width: 90vw;
            max-width: 400px;
        }

        #newsPreviewModal .modal-dialog {
            width: 90vw;
            max-width: 1000px;
            margin: 1rem auto;
        }

        #fullContentModal .modal-dialog {
            width: 90vw;
            max-width: 1000px;
            margin: 1rem auto;
        }

        @media (max-width: 576px) {
            #loginModal .modal-dialog {
                width: 95vw;
                max-width: 350px;
            }

            #newsPreviewModal .modal-dialog {
                width: 95vw;
                max-width: 600px;
            }

            #fullContentModal .modal-dialog {
                width: 95vw;
                max-width: 600px;
            }

            .login-container {
                padding: 1.5rem;
                max-width: 100%;
            }

            .login-container .form-control {
                height: 5vh;
                padding: 0.5rem 1rem;
            }

            .login-header {
                font-size: 1.4rem;
            }
        }
        .news-card {
            position: relative;
            width: 100%;
            background-color: white;
            border: 1px solid var(--form-primary-light);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .news-card:hover {
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        .news-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1rem;
        }

        .category {
            font-size: 0.9em;
            font-weight: 500;
            color: var(--form-primary-color);
        }

        .badge {
            background-color: #dc3545;
            color: var(--text-light);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.8em;
            position: absolute;
            top: 10px;
            right: 10px;
        }

        #fullContentModal .badge {
            top: -20px;
            right: 10px;
            position: absolute;
            z-index: 1;
        }

        #fullContentModal #full-news-image-container {
            position: relative;
        }

        .news-card h3[contenteditable], .news-card p[contenteditable], .news-card input[type="date"], .news-card select {
            border: 1px dashed var(--form-primary-light);
            padding: 5px;
            border-radius: 4px;
            margin-bottom: 10px;
            width: 100%;
        }

        .news-card h3[contenteditable] {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--text-dark);
        }

        .news-card input[type="date"], .news-card select {
            padding: 5px;
            font-size: 0.9em;
        }

        .news-card p[contenteditable] {
            font-size: 0.95em;
            color: var(--text-dark);
        }

        .read-more {
            color: var(--form-primary-color);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9em;
            display: block;
            text-align: right;
            cursor: pointer;
        }

        .read-more:hover {
            text-decoration: underline;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            padding: 0 20px 20px;
        }

        .modal-buttons button {
            width: 50%;
        }

        .modal-buttons .publish-btn {
            background-color: var(--form-primary-color);
        }

        .modal-buttons .publish-btn:hover {
            background-color: var(--form-primary-dark);
        }

        .modal-buttons .cancel-btn {
            background-color: #6c757d;
        }

        .modal-buttons .cancel-btn:hover {
            background-color: #5a6268;
        }

        .full-content-body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f9f9f9;
        }

        .hero-section {
            background: var(--form-primary-color) !important;
            color: var(--text-light);
            padding: 15px 12px;
            text-align: center;
        }

        .hero-section h1 {
            font-size: 35px;
            margin-top: 20px;
        }

        .hero-section p {
            font-size: 15px;
            margin-top: -4px;
        }

        .news-detail-section {
            padding: 3rem 1rem;
        }

        .news-header i {
            font-size: 1.5rem;
            color: var(--form-primary-color);
        }

        .news-content {
            line-height: 1.6;
            font-size: 0.95em;
            color: var(--text-dark);
        }

        .news-image {
            width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            object-fit: cover;
        }

        .news-image-placeholder {
            width: 100%;
            max-height: 200px;
            background-color: #e0e0e0;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #777;
            font-style: italic;
        }

        @media (max-width: 576px) {
            .news-image, .news-image-placeholder {
                max-height: 150px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content login-container">
                <h1 class="login-header">Login</h1>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" id="username" class="form-control" placeholder="Enter your username" required>
                        <span id="usernameError" class="error-message"></span>
                    </div>
                    <div class="form-group">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                        <span id="passwordError" class="error-message"></span>
                    </div>
                    <div id="errorMessage" class="error-message" style="display: none;">Invalid username or password.</div>
                    <button type="button" id="loginButton" class="btn-login">Sign In</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="modal fade" id="newsPreviewModal" tabindex="-1" aria-labelledby="newsPreviewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newsPreviewModalLabel">News Card Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="previewCard" class="news-card"></div>
                </div>
                <div class="modal-buttons">
                    <button id="publishButton" class="publish-btn">Publish</button>
                    <button id="cancelButton" class="cancel-btn">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Full Content Modal -->
    <div class="modal fade" id="fullContentModal" tabindex="-1" aria-labelledby="fullContentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="fullContentModalLabel">News Card Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body full-content-body">
                    <section class="hero-section">
                        <h1>News Detail</h1>
                        <p>Stay updated with our latest news and announcements</p>
                    </section>
                    <section class="news-detail-section container">
                        <div id="fullContentCard"></div>
                    </section>
                </div>
            </div>
        </div>
    </div>

    <div class="form-container" id="formContainer">
        <h2>Add News Card</h2>
        <form id="newsForm">
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" required placeholder="Enter news title">

            <label for="category">Category:</label>
            <select id="category" name="category" required>
                <option value="announcement">Announcement</option>
                <option value="student">Student</option>
                <option value="examination">Examination</option>
                <option value="academic">Academic</option>
            </select>

            <label for="date">Date:</label>
            <input type="date" id="date" name="date" required>

            <label for="content">Content:</label>
            <textarea id="content" name="content" required placeholder="Enter news content"></textarea>

            <label for="image">Image:</label>
            <input type="file" id="image" name="image" accept="image/*">

            <button id="reviewButton" type="button" class="mt-3">Review</button>
            <button id="logoutButton" type="button" class="mt-3 logout-btn">Logout</button>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const VALID_USERNAME = 'admin';
        const VALID_PASSWORD = 'admin';
        const SESSION_TIMEOUT = 30 * 60 * 1000;
        let timeoutId;

        function checkAuthentication() {
            const isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';
            const loginTimestamp = localStorage.getItem('loginTimestamp');
            const currentTime = Date.now();

            if (isAuthenticated && loginTimestamp) {
                const timeSinceLogin = currentTime - parseInt(loginTimestamp);
                if (timeSinceLogin < SESSION_TIMEOUT) {
                    document.getElementById('formContainer').classList.add('show');
                    startSessionTimeout();
                    return;
                }
            }
            localStorage.removeItem('isAuthenticated');
            localStorage.removeItem('loginTimestamp');
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'), { backdrop: 'static', keyboard: false });
            loginModal.show();
        }

        function startSessionTimeout() {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => {
                logoutDueToInactivity();
            }, SESSION_TIMEOUT);
        }

        function logoutDueToInactivity() {
            localStorage.removeItem('isAuthenticated');
            localStorage.removeItem('loginTimestamp');
            alert('Session timed out due to inactivity. Please log in again.');
            window.location.href = 'index.html';
        }

        function resetTimeoutOnActivity() {
            startSessionTimeout();
        }

        window.addEventListener('DOMContentLoaded', function() {
            checkAuthentication();
            document.addEventListener('mousemove', resetTimeoutOnActivity);
            document.addEventListener('click', resetTimeoutOnActivity);
            document.addEventListener('keypress', resetTimeoutOnActivity);
        });

        document.getElementById('loginButton').addEventListener('click', function() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');

            if (username === VALID_USERNAME && password === VALID_PASSWORD) {
                localStorage.setItem('isAuthenticated', 'true');
                localStorage.setItem('loginTimestamp', Date.now().toString());
                const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                loginModal.hide();
                document.getElementById('formContainer').classList.add('show');
                startSessionTimeout();
            } else {
                errorMessage.style.display = 'block';
            }
        });

        document.getElementById('logoutButton').addEventListener('click', function() {
            clearTimeout(timeoutId);
            localStorage.removeItem('isAuthenticated');
            localStorage.removeItem('loginTimestamp');
            window.location.href = 'index.html';
        });

        let formData = {};
        let imageBase64 = '';
        let tempId = null;

        document.getElementById('reviewButton').addEventListener('click', function() {
            const form = document.getElementById('newsForm');
            if (form.checkValidity()) {
                formData = {
                    title: document.getElementById('title').value,
                    category: document.getElementById('category').value,
                    date: document.getElementById('date').value,
                    content: document.getElementById('content').value
                };

                const imageInput = document.getElementById('image');
                if (imageInput.files.length > 0) {
                    const file = imageInput.files[0];
                  
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imageBase64 = e.target.result;
                        showPreviewModal();
                    };
                    reader.readAsDataURL(file);
                } else {
                    imageBase64 = '';
                    showPreviewModal();
                }
            } else {
                form.reportValidity();
            }
        });

        function showPreviewModal() {
            tempId = Date.now();
            const previewCard = document.getElementById('previewCard');
            previewCard.innerHTML = `
                <div class="news-header">
                    <i class="${getCategoryIcon(formData.category)}"></i>
                    <select id="previewCategory" class="category">
                        <option value="announcement" ${formData.category === 'announcement' ? 'selected' : ''}>Announcement</option>
                        <option value="student" ${formData.category === 'student' ? 'selected' : ''}>Student</option>
                        <option value="examination" ${formData.category === 'examination' ? 'selected' : ''}>Examination</option>
                        <option value="academic" ${formData.category === 'academic' ? 'selected' : ''}>Academic</option>
                    </select>
                    <span class="badge">Important</span>
                </div>
                <h3 contenteditable="true" id="previewTitle">${formData.title}</h3>
                <input type="date" id="previewDate" value="${formData.date}">
                <p contenteditable="true" id="previewContent">${formData.content}</p>
                <span id="readMoreLink" class="read-more">Read More →</span>
            `;

            document.getElementById('previewCategory').addEventListener('change', function() {
                const icon = previewCard.querySelector('i');
                icon.className = getCategoryIcon(this.value);
            });

            document.getElementById('readMoreLink').addEventListener('click', function() {
                showFullContentModal();
            });

            const modal = new bootstrap.Modal(document.getElementById('newsPreviewModal'));
            modal.show();
        }

        function showFullContentModal() {
            const fullContentCard = document.getElementById('fullContentCard');
            const categoryValue = document.getElementById('previewCategory').value;
            const categoryText = categoryValue.charAt(0).toUpperCase() + categoryValue.slice(1);
            const title = document.getElementById('previewTitle').textContent;
            const date = document.getElementById('previewDate').value;
            const content = document.getElementById('previewContent').textContent;

            fullContentCard.innerHTML = `
                <div class="news-header">
                    <i class="${getCategoryIcon(categoryValue)}"></i>
                    <span class="category">${categoryText}</span>
                    <span class="badge">Important</span>
                </div>
                <h1 class="mb-3">${title}</h1>
                <div id="full-news-image-container"></div>
                <time class="d-block mb-3 text-muted">${date}</time>
                <p class="news-content">${content}</p>
            `;

            const imageContainer = document.getElementById('full-news-image-container');
            if (imageBase64) {
                const img = document.createElement('img');
                img.src = imageBase64;
                img.alt = title;
                img.className = 'news-image';
                imageContainer.appendChild(img);
            } else {
                const placeholder = document.createElement('div');
                placeholder.className = 'news-image-placeholder';
                placeholder.textContent = 'No Image Available';
                imageContainer.appendChild(placeholder);
            }

            const fullContentModal = new bootstrap.Modal(document.getElementById('fullContentModal'));
            fullContentModal.show();
        }

        document.getElementById('publishButton').addEventListener('click', function() {
            const updatedTitle = document.getElementById('previewTitle').textContent;
            const updatedCategory = document.getElementById('previewCategory').value;
            const updatedDate = document.getElementById('previewDate').value;
            const updatedContent = document.getElementById('previewContent').textContent;

            let newsCards = JSON.parse(localStorage.getItem('newsCards') || '[]');

            const newCard = {
                id: tempId,
                category: updatedCategory.charAt(0).toUpperCase() + updatedCategory.slice(1),
                icon: getCategoryIcon(updatedCategory),
                title: updatedTitle,
                date: updatedDate,
                datetime: updatedDate,
                content: updatedContent,
                image: imageBase64,
                createdAt: new Date().toISOString()
            };

            newsCards.unshift(newCard);
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            newsCards = newsCards.filter(card => new Date(card.createdAt) >= sevenDaysAgo);
            newsCards = newsCards.slice(0, 5);
            localStorage.setItem('newsCards', JSON.stringify(newsCards));

            document.getElementById('newsForm').reset();
            const modal = bootstrap.Modal.getInstance(document.getElementById('newsPreviewModal'));
            modal.hide();
            alert('News card published! It will appear in the news section of the homepage.');
            window.location.href = 'index.html';
        });

        document.getElementById('cancelButton').addEventListener('click', function() {
            document.getElementById('newsForm').reset();
            const modal = bootstrap.Modal.getInstance(document.getElementById('newsPreviewModal'));
            modal.hide();
        });

        function getCategoryIcon(category) {
            const categoryIcons = {
                announcement: 'fa-calendar',
                student: 'fa-bullhorn',
                examination: 'fa-file-alt',
                academic: 'fa-book'
            };
            return `fa-solid ${categoryIcons[category] || 'fa-calendar'}`;
        }
    </script>
</body>
</html>