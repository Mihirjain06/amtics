<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Detail | AMTICS</title>
    <link rel="icon" href="images/amtics_favicon.ico" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f9f9f9;
        }

        .hero-section {
            background: #5c4fc4 !important;
            color: white;
            padding: 15px 12px;
            text-align: center;
        }

        .hero-section h1 {
            font-size: 35px;
            margin-top: 20px;
        }

        .hero-section p {
            font-size: 15px;
            margin-top: -4px;
        }

        .news-detail-section {
            min-height: 100vh;
            padding: 3rem 0;
        }

        .news-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1rem;
        }

        .news-header i {
            font-size: 1.5rem;
            color: #3b3285;
        }

        .category {
            font-weight: bold;
            color: #555;
        }

        .badge {
            background-color: #dc3545;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.8em;
            position: absolute;
            top: -20px;
            right: 10px;
            z-index: 1;
        }

        #news-image-container {
            position: relative;
        }

        .news-content {
            line-height: 1.6;
        }

        .back-link {
            display: inline-block;
            margin-top: 1.5rem;
            color: #3b3285;
            text-decoration: none;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .news-image {
            width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            object-fit: cover;
        }

        @media (max-width: 576px) {
            .news-image {
                max-height: 150px;
            }
        }
    </style>
</head>
<body>
    <div id="navbar-container"></div>

    <!-- Hero Section -->
    <section class="hero-section">
        <h1>News Detail</h1>
        <p>Stay updated with our latest news and announcements</p>
    </section>

    <!-- News Detail Section -->
    <section class="news-detail-section container">
        <div id="news-detail">
            <div class="news-header">
                <i id="news-icon"></i>
                <span id="news-category" class="category"></span>
                <span id="news-badge" class="badge">Important</span>
            </div>
            <h1 id="news-title" class="mb-3"></h1>
            <div id="news-image-container"></div>
            <time id="news-date" class="d-block mb-3 text-muted"></time>
            <p id="news-content" class="news-content"></p>
            <a id="back-link" href="News&Events.html" class="back-link">← Back to Home</a>
        </div>
    </section>

    <div id="footer-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/loadheaderfooter.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const newsId = parseInt(urlParams.get('id'));

        function parseDateToISO(dateStr) {
            try {
                const date = new Date(dateStr);
                if (isNaN(date)) throw new Error('Invalid date');
                return date.toISOString().split('T')[0];
            } catch (e) {
                return dateStr;
            }
        }

        let newsItem = null;
        const newsCards = JSON.parse(localStorage.getItem('newsCards') || '[]');
        if (newsCards.length > 0) {
            newsItem = newsCards.find(item => item.id === newsId);
        }

        function populateNewsDetails(item) {
            if (item) {
                document.getElementById('news-icon').className = item.icon || 'fa-solid fa-newspaper';
                document.getElementById('news-category').textContent = item.category || 'Event';
                document.getElementById('news-title').textContent = item.title;
                document.getElementById('news-date').textContent = item.date;
                document.getElementById('news-date').setAttribute('datetime', parseDateToISO(item.date));
                document.getElementById('news-content').textContent = item.content;

                const imageContainer = document.getElementById('news-image-container');

                if (item.image && item.image.trim() !== '') {
                    const img = new Image();
                    img.src = item.image;
                    img.className = 'news-image';

                    img.onload = function () {
                        imageContainer.appendChild(img);
                        imageContainer.style.display = 'block';
                    };

                    img.onerror = function () {
                        imageContainer.style.display = 'none';
                    };
                } else {
                    imageContainer.style.display = 'none';
                }

            } else {
                document.getElementById('news-detail').innerHTML = `
                    <h1>News Not Found</h1>
                    <p>Sorry, the news item you are looking for does not exist.</p>
                    <a href="index.html" class="back-link">← Back to Home</a>
                `;
            }
        }

        if (newsItem) {
            populateNewsDetails(newsItem);
        } else {
            const scriptSrc = (newsId >= 21 && newsId <= 27) ? 'js/announcement.js' : 'js/newsdata.js';
            const script = document.createElement('script');
            script.src = scriptSrc;
            script.onload = function () {
                newsItem = newsData.find(item => item.id === newsId);
                populateNewsDetails(newsItem);
            };
            script.onerror = function () {
                document.getElementById('news-detail').innerHTML = `
                    <h1>Error Loading News</h1>
                    <p>Sorry, there was an error loading the news data.</p>
                    <a href="index.html" class="back-link">← Back to Home</a>
                `;
            };
            document.head.appendChild(script);
        }
    </script>
</body>
</html>
